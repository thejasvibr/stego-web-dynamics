---
title: "Web_stuff_March2016"
author: "Thejasvi"
date: "Tuesday, March 29, 2016"
output: html_document
---

###This is a whole bunch of rough analyses+plots of social spider web construction.  
###Spiders were kept in 4 group sizes (1,5,10,25) and allowed to build webs on a 2x2feet wire frame. Using a custom-modified version of Angioquant, a freely available MATLAB toolbox, I extracted skeletonised forms of these webs over multiple spatial resolutions over the period of the experiment. 

###The dataset being analysed 'skeletondata,csv' has the following column headers:
### 1)colonyname 2)groupsize 3)Image name 4) Length of silk in grid 5) Number of junctions in grid
###6)Serial number of grid (arranged column-wise from top-to-bottom) 7)Overal grid dimensions (eg. 32 means a 32x32 grid) 8) day, serial number of the reading from the start of experiment

#####You are reading a version of the report compiled on `r date()`

--------------

```{r, echo=FALSE,cache=TRUE}
#dorig<-read.csv('C:/Users/Thejasvi/Google Drive/stego web/web-construction FINAL round - raw data/analysis-FINALround/analysis input-data/semifinal16thmay/skeletondata.csv')

# also loading the multiplot function, which will be super useful as we go on:

#load the multiplot script that's sooo awesome in making panel graphs
source('E:/stego web/web-construction FINAL round - raw data/analysis-FINALround/analysis-scripts/smoothworkflow/multiplot.R')

# pixpm --> is the scaling factor from pixels --> metres.

# common address:

comad<-'C:/Users/Thejasvi/Google Drive/stego web/web-construction FINAL round - raw data/analysis-FINALround/analysis-results/semifinal_16May/'


ps=1;
``` 


```{r, echo=FALSE,fig.width=12,fig.height=8}

## cleaning up the d$Length column because if increases and decreases ! 

#source(paste(comad,'Lengthclean.R',sep=''))

#TAIM<-system.time(procadjstlist<-prlladjstr()) # the processed list which has run thru Ladjstr

# ---- MAKING THIS THE FINAL DATASET FOR ALL ANALYSIS AND MANIPULATIONS !! 

#d<-do.call(rbind,procadjstlist) # rbinding all the lists into THE dataset

#-----loading it each time, instead of having to run all these commands! 

d<-read.csv(paste(comad,'finaldataset.csv',sep=''))
```


### A quick view of all the data together

###*Plot `r ps`: Length of silk vs time: Whole data :*


```{r,echo=FALSE}
# now making the plots of the 'corrected' data 
library(ggplot2)

wd<-subset(d,d$GridSize==1)

 q025<-function(v){return(quantile(v,0.025,na.rm=T))} # gives output of 2.75%ile
 q975<-function(v){return(quantile(v,0.975,na.rm=T))} # gives output of 97.5%iles

#   a plot to see the numbers in metres
# 1536 pixels== 24 inches ==> 60.96 cm--> 1536/60.96 --> 
pixpm<-1536/.6096     # number of pixels per m 

wd$Lengthm<-wd$Length/pixpm

p1mtrs<-ggplot(wd,aes(as.factor(day),Length/pixpm,color=as.factor(groupsize),group=colonyname)) 
p11mtrs<-p1mtrs+geom_point()+geom_line(linetype='solid',size=0.75)+ylab('Length of silk (metres) ') + xlab('Days');

p2mtrs<-ggplot(wd,aes(day,Length/pixpm,color=as.factor(groupsize),group=groupsize))  + stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5) +ylab('')+xlab('Days')+scale_x_discrete(breaks=c(1:10),labels=c(1:10));


# figure 3 : plot with standard errors

# now need to make a new plot with days on x , mean + se on y axis for each group size :
mnwd<-aggregate(Lengthm ~ day*groupsize, data = wd, mean);colnames(mnwd)[3]<-'meanL'
sdwd<-aggregate(Lengthm ~ day*groupsize, data = wd, sd);colnames(sdwd)[3]<-'sdL'
# merged and ordered
mgwd<-merge(mnwd,sdwd); mgwd<-mgwd[order(mgwd[,1],mgwd[,2]),]

#
pd <- position_dodge(width = 0.8)
mgwd1<-subset(mgwd,day<10)
mgplt<- ggplot(mgwd1,aes(x=as.factor(day),y=meanL,group=as.factor(groupsize),col=as.factor(groupsize))) +geom_pointrange(aes(ymin=meanL-sdL, ymax=meanL+sdL,shape=as.factor(mgwd1$groupsize),width=0.9),size=1.1,position=pd) + xlab('Days') + ylab('Length of silk (metres)') +geom_line(lwd=1,position=pd)  ; mgplt




ps<-ps+1;


multiplot(p11mtrs,p2mtrs,cols=2)


```

#####*The lines show the 95% interval of the data from the median (2.75% and 97.25%)

#### There seems to be a decent amount of overlap in silk investment across group sizes - but the 25 spider group seems to be quite distinct. This points to quite a bit of colony level variation. 

### *Plot `r ps`*: How does the amount of silk scale with groupsize across time ?

```{r,width=12,fig.height=8}

#   SHOWS THE MEDIAN VALUE AT TIME WITH GROUP-SIZE ON X-AXIS
daywiseplots<-ggplot(wd,aes(x=as.factor(groupsize),y=Length/pixpm,color=as.factor(day),group=as.factor(day)))  + stat_summary(fun.y = median,fun.ymin=q025,fun.ymax=q975,size=1.5,geom='line') +ylab('')+xlab('groupsize')+scale_x_discrete(breaks=c(1,5,10,25),labels=c(1,5,10,25))

daywiseplots

ps<-ps+1
```


```{r}

M1p<-ggplot(wd,aes(x=day,y=log10(Length/pixpm+0.001),color=as.factor(groupsize),group=groupsize))+geom_smooth(lwd=2)+ylim(0,2.5)+ylab('Log10 length of silk on web (metres)')+theme(legend.position='none')

 M2p<-ggplot(wd,aes(x=day,y=Length/pixpm,color=as.factor(groupsize),group=groupsize))+geom_smooth(lwd=2)+ylab('Length of silk on web (metres)')+theme(legend.position=c(0.25,0.95))

multiplot(M2p,M1p,cols=2)
```




### *Plot `r ps `* : $\Delta\$ silk investment over time:

```{r,echo=FALSE,warning=FALSE, fig.width=15, fig.height=8,message=FALSE}
#assigning a new column:

# OMG the 'by'  function is soooo neat:
wddif<-by(wd$Length,wd$colonyname,diff) # apply the function for every colonyname and get the output 

#now to join up all these vectors:
library(qpcR);
library(reshape2);
fun<-qpcR:::cbind.na
dlength<-do.call(fun,wddif) # a columnwise data.frame with change in lengths
#convert this 'wide' formate to a 'long' format using 'melt' in reshape2
dlenth<-melt(dlength);names(dlenth)<-c('day','colonyname','dLength');

# removes the last alphabet from the colonyname
endremv<-function(nem){ if (is.na(nem)==FALSE) {as.numeric(substr(nem, 1, nchar(nem)-1))} else if (is.na(nem)==TRUE){return(NA)} } 

dlenth$groupsize<-as.numeric(lapply(as.character(dlenth$colonyname),endremv)) # and we have our final dataset:

dg1<-ggplot(dlenth,aes(x=day,y=dLength/pixpm,group=colonyname,colour=as.factor(groupsize)))+geom_point()+geom_line(linetype='solid',size=0.75)+ylab('Growth in silk investment (metres)') + xlab('Days')+scale_x_discrete(breaks=c(1:9),labels=c(1:9))+theme(legend.position='none')

dg2<-ggplot(dlenth,aes(x=day,y=dLength/pixpm,color=as.factor(groupsize),group=groupsize))  + stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5,position=position_dodge(width=0.65)) +ylab('')+xlab('Days')+scale_x_discrete(breaks=c(1:9),labels=c(1:9))+theme(legend.position=c(0.85,0.85));

multiplot(dg1,dg2,cols=2)

#dg2+ylab('Daily web silk investment (m)')+theme(legend.title=element_blank())
dg3<-ggplot(dlenth,aes(x=day,y=dLength/pixpm,color=as.factor(groupsize),group=groupsize))+geom_point()  + stat_smooth(lwd=2,level=0.95) +ylab('')+xlab('Days')+scale_x_discrete(breaks=c(1:9),labels=c(1:9))+theme(legend.position=c(0.85,0.85))+theme(legend.title=element_blank())+ylab('Daily silk investment (metres)');dg3




ps<-ps+1
```


### *Plot `r ps `* : Per Capita $\Delta\$ silk investment :
```{r,echo=FALSE,warning=FALSE,fig.width=12,fig.height=8}

# divide the dLength/groupsize - make a new column of it :

dlenth$percap<-(dlenth$dLength/dlenth$groupsize)/pixpm # percapita in metres

#ggplot(dlenth,aes(x=day,y=percap/pixpm,color=as.factor(groupsize),group=groupsize)) 

pcp1<-ggplot(dlenth,aes(x=day,y=percap/pixpm,color=as.factor(groupsize),group=as.factor(groupsize)))  + stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5,position=position_dodge(width=0.65)) +ylab('Per-capita silk investment (m)')+xlab('Days')+scale_x_discrete(breaks=c(1:9),labels=c(1:9))+theme(legend.position=c(0.75,0.85))+theme(legend.title=element_blank());pcp1

pcp3<-ggplot(dlenth,aes(x=day,y=percap/pixpm))+geom_point(size=4)+stat_smooth()+ylab('Per-capita silk investment (m)') + xlab('Days')+scale_x_discrete(breaks=c(1:9),labels=c(1:9))+theme(legend.position=c(0.75,0.85))+theme(legend.title=element_blank());pcp3

pcp2<-ggplot(dlenth,aes(x=day,y=percap/pixpm,group=groupsize,colour=as.factor(groupsize)))+geom_point(size=4)+geom_smooth(linetype='solid',lwd=2,level=0.9)+ylab('Per-capita silk investment (m)') + xlab('Days')+scale_x_discrete(breaks=c(1:9),labels=c(1:9))+theme(legend.position=c(0.75,0.85))+theme(legend.title=element_blank());pcp2


# now to make the pcp2 plot to show the averaged per-capita silk with se:

# figure 4 : 



# now need to make a new plot with days on x , mean + se on y axis for each group size :
mnpc<-aggregate(percap ~ day*groupsize, data = dlenth, mean);colnames(mnpc)[3]<-'meanPC'
sdpc<-aggregate(percap ~ day*groupsize, data = dlenth, sd);colnames(sdpc)[3]<-'sdPC'
# merged and ordered
mgpc<-merge(mnpc,sdpc); mgpc<-mgpc[order(mgpc[,1],mgpc[,2]),]

#
pd <- position_dodge(width = 0.8)
mgpc1<-subset(mgpc,day<9)
mgpltpc<- ggplot(mgpc1,aes(x=as.factor(day),y=meanPC,group=as.factor(groupsize),col=as.factor(groupsize))) +geom_pointrange(aes(ymin=meanPC-sdPC, ymax=meanPC+sdPC,shape=as.factor(mgpc1$groupsize),width=0.9),size=1.1,position=pd) + xlab('Days') + ylab('Per-capita silk investment (metres)') +geom_line(lwd=1,position=pd)  ; mgpltpc



````





####This makes one wonder how silk investment varies as a function of existing silk at the web-level:

###Plot `r ps`: $\Delta$Silk vs Silk at the web-level:  do webs of different group sizes grow differently?

```{r,del silk web level, echo=FALSE,warning=FALSE,message=FALSE,fig.align='center'}

#create a df that combines the delta silk and silk values :

wdlenth<-merge(wd,dlenth)


wdg1<-ggplot(wdlenth,aes(x=Length/pixpm,y=dLength/pixpm,colour=as.factor(groupsize)))+geom_point(size=3)+ylab(expression(paste(Delta,'Silk addition (metres)'))) + xlab('Total amount of silk (metres)')
wdg1


ps<-ps+1
```


### *Plot `r ps`: Length of silk vs time: by group size :*
#### A quick look at how much colony-level variation there is in growth trajectories across all group sizes

```{r,global_options, echo=FALSE,fig.width=12,fig.height=12}
gs1<-subset(wd,wd$groupsize==1) # group size one
gs5<-subset(wd,wd$groupsize==5) # group size five
gs10<-subset(wd,wd$groupsize==10)
gs25<-subset(wd,wd$groupsize==25)

pgs1<-ggplot(gs1,aes(day,Length/pixpm,color=as.factor(colonyname),group=as.factor(colonyname)))+geom_line()+ggtitle('1 spider')+geom_point()+scale_x_discrete(breaks=c(1:10),labels=c(1:10))+ylab('Length of silk on web (metres)')
pgs5<-ggplot(gs5,aes(day,Length/pixpm,color=as.factor(colonyname),group=as.factor(colonyname)))+geom_line()+ggtitle('5 spiders')+geom_point()+scale_x_discrete(breaks=c(1:10),labels=c(1:10))+ylab('Length of silk on web (metres)')
pgs10<-ggplot(gs10,aes(day,Length/pixpm,color=as.factor(colonyname),group=as.factor(colonyname)))+geom_line()+ggtitle('10 spiders')+geom_point()+scale_x_discrete(breaks=c(1:10),labels=c(1:10))+ylab('Length of silk on web (metres)')
pgs25<-ggplot(gs25,aes(day,Length/pixpm,color=as.factor(colonyname),group=as.factor(colonyname)))+geom_line()+ggtitle('25 spiders')+geom_point()+scale_x_discrete(breaks=c(1:10),labels=c(1:10))+ylab('Length of silk on web (metres)')




multiplot(pgs1,pgs10,pgs5,pgs25,cols=2)


ps<-ps+1

```

####There seems to be a fair amount of colony level variation at the lower group sizes (1,5,10) - and a lot of variation at the single spider level.

```{r,normalised web data, echo=FALSE,results='hide',warning=FALSE,message=FALSE}

####*Web growth normalised to first day: Overall*

# making a new column for the data set to creat normalised plots:

 clnm<-unique(wd$colonyname)
 for (cnm in clnm)
  {
  colnem<-wd$colonyname==cnm
  lents<-wd$Length[colnem]
  if (lents[1]>0)
  {
  wd$norm1[colnem]<-lents/lents[1]
  }
  if (lents[1]==0)
    {
    
    wd$norm1[colnem]<-lents/lents[2]
    }
   }

```

### Plot `r ps`: Normalised web dynamics : *how much do webs grow in comparison to day  1?* 
#### The amount of silk on each day was divided by the amount of silk on day 1 - to see by what factor of their initial size webs grow. Each day's normalised length was calculated as :
<center><h4>Normalised length [day i]= Length[day i]/ Length [day 1]<h4><center>
  
```{r, echo=FALSE,warning=FALSE}
#make new subsets after adding the new column !
gs1<-subset(wd,wd$groupsize==1) # group size one
gs5<-subset(wd,wd$groupsize==5) # group size five
gs10<-subset(wd,wd$groupsize==10)
gs25<-subset(wd,wd$groupsize==25)



p11<-ggplot(wd,aes(day,norm1,color=as.factor(groupsize),group=as.factor(wd$colonyname) ) ) + theme(legend.position=c(0.15,0.85), legend.direction="horizontal")
p22<-p11+geom_line(linetype='solid',size=0.75)+geom_point(size=2.5)+xlab('Days')+ylab('Normalised growth (to day 1)') +scale_x_discrete(breaks=c(1:10),labels=c(1:10)) + labs(colour = "") +ggtitle('Raw data: each line is a colony')+theme(legend.position='none')

#p22

o11<-ggplot(wd,aes(x=day,y=norm1,group=groupsize,colour=as.factor(groupsize)) ) 
o22<-o11 + stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1) +ylab('')+xlab('Days')+scale_x_discrete(breaks=c(1:10),labels=c(1:10)) + theme(legend.position=c(0.15,0.85), legend.direction="horizontal")+ labs(colour = "")+ggtitle('Median and 95%ile limits')

#o22

multiplot(p22,o22,cols=2)

ps<-ps+1

```

####We can see that single and 5 spider colonies grow the most from their 1st day size.



---------------

##How do spider weight and spider size correlate with the kind of webs that are built ?
####Spider weights were measured at upto 0.0001 gm accuracy (weights of spiders measured at APU were *not* included as the machine was faulty). Spider size/age was estimated by  measuring the cephalothorax width. The cephalothorax is the front half of the spider body, and its width is known to correlate with spider age. 

###*Exploratory plots of spider weight and size:*
####*Achtung:current data needs a little more cleaning*
```{r,echo=FALSE}
# load the csv file with wts and ceph widths :
wtadrs<-'C:/Users/Thejasvi/Google Drive/stego web/web-construction FINAL round - raw data/analysis-FINALround/analysis input-data/finalwtsnsizes.csv' # address of the weights and sizes csvfile
wts<-read.csv(wtadrs)
wts<-subset(wts,wts$groupsize!='NA') # cleaning up the data frame once more to avoid an extra 'NA' group ! 
# before weights
```

### *Plot `r ps`:* Are the weight of spiders across all the group sizes are comparable?
```{r, echo=FALSE, warning=FALSE}


b4w<-ggplot(wts,aes(x=as.factor(groupsize),y=b4wt))+ggtitle('Before weights')+ylab('Weight (gm)') +xlab('Group size')+ylim(0.02,0.13)+geom_jitter(color=as.factor(wts$groupsize))
# after weights 
aftw<-ggplot(wts,aes(x=as.factor(groupsize),y=aftrwt))+ggtitle('After weights')+xlab('Group size')+ylab('')+ylim(0.02,0.13)+geom_jitter(color=as.factor(wts$groupsize))

multiplot(b4w,aftw,cols=2)
ps<-ps+1
```

####This is a crude plot with ALL the spiders in each group size (pooling in spiders from all colonies) - but shows that the spiders are more-or-less of similar weight. 

### *Plot `r ps`:* I've also made the same kind of plot to look at the cephalothorax widths of the spiders:
```{r,echo=FALSE,warning=FALSE}
cephcomp<-ggplot(wts,aes(x=as.factor(groupsize),y=cephwid))+ggtitle('Cephalothorax width')+ylab('Cephalothorax width (mm)') +xlab('Group size')+geom_jitter(color=as.factor(wts$groupsize));cephcomp
ps<-ps+1
```

####This plot tells us that the spiders we've taken are of more-or-less the similar size.

###*Plot `r ps`:* Are the spiders we've used across group sizes similar in size and weight?
####If they are similar in size and shape, the points should generally occupy the same and overlapping region in a spider size vs wt plot. 
```{r,echo=FALSE,warning=FALSE}
siznwt<-ggplot(wts,aes(x=b4wt,y=cephwid,color=as.factor(wts$groupsize)))+geom_point(size=3)+ylab('Cephalothorax width (mm)') +xlab('Weight (gm)') +ylab('Cephalothorax width (mm)')  ;siznwt
ps<-ps+1
```


####From this plot, we can see that in general the 10-spider groups are distributed a little more towards the bottom-left of the scatter, while the 25 , 5 and 1 are distributed somewhat more evenly. 


*More analysis coming up:*
1. Look at what the stats say about group size and spider weight/size
2. XY plot of day and day7 silk investment at whole group vs avg+sd of spider wts.

###*Plot `r ps`: Does average colony weight loss predict silk investment?*
####By comparing the average weight loss seen in each colony's spiders we can check if the weight lost over the period of the experiment is correlated with amount of silk invested:
```{r,echo=FALSE}
# now we make a new column called wtlss in the wts data frame :
wts$wtlss<-wts$b4wt-wts$aftrwt
wd7<-subset(wd,day==7)
# and now lets assign these wts onto each colonyname in the wd7 data set
i=1;
wtlscol<-data.frame(data=NA)
comnms<-intersect(unique(wd7$colonyname),unique(wts$colonyname))
for (cn in comnms)
  {
  #wtloss by colony:
  wtlscol[i,1]<-cn
  
  wtlscol[i,2]<-mean(subset(wts,wts$colonyname==cn)$wtlss,na.rm=TRUE)
  wtlscol[i,3]<-sd(subset(wts,wts$colonyname==cn)$wtlss,na.rm=TRUE)

  lnt<-subset(wd7,wd7$colonyname==cn)$Length 
     

 wtlscol[i,4]<-lnt
  wtlscol[i,5]<-subset(wd7,wd7$colonyname==cn)$groupsize  
 wtlscol[i,6]<-mean(subset(wts,wts$colonyname==cn)$cephwid,na.rm=TRUE)
 wtlscol[i,7]<-sd(subset(wts,wts$colonyname==cn)$cephwid,na.rm=TRUE)
 
   i<-i+1
  }
names(wtlscol)<-c('colonyname','wtls','sdwtls','Length','groupsize','mncephwidth','sdceph')
```


```{r,echo=FALSE,warning=FALSE}
G<-ggplot(wtlscol,aes(x=wtls,y=Length/pixpm/groupsize,colour=as.factor(groupsize)))+geom_point(size=4);G+xlab('Mean weight loss (gm)')+ ylab('Per-capita investment of silk on day 7 (metres)')+ geom_errorbarh(aes(xmax = wtls + sdwtls, xmin = wtls - sdwtls, height = .5))

ps<-ps+1
```

There doesn't seem to be any correlation between the weight loss and amount of silk invested overall. Of course, this isn't the exact level to be studying this question at. Ideally, we should've had behavioural/silk data on individual silk investment on each day with weight loss overall. Even then, if there is a good amount of variance in weight loss within a group, it would point to inter-individual differences in silk investment. 

###*Plot `r ps`:* How much variation in weight loss is there across colonies ?

```{r,echo=FALSE,warning=FALSE,fig.height=10,fig.width=12}

wts25<-subset(wts, wts$groupsize==25)
wts10<-subset(wts, wts$groupsize==10)
wts5<-subset(wts, wts$groupsize==5)
wts1<-subset(wts, wts$groupsize==1)
p25<-ggplot(wts25, aes(x=as.factor(colonyname),y=wtlss,color=as.factor(colonyname)))+ geom_jitter()+ ylim(0,0.05) +xlab('')+ylab('') # 25 spider colonies
p10<-ggplot(wts10, aes(x=as.factor(colonyname),y=wtlss,color=as.factor(colonyname))) + geom_jitter()+ylim(0,0.05)+xlab('')+ylab('') # 10 spider colonies
p5<-ggplot(wts5, aes(x=as.factor(colonyname),y=wtlss,color=as.factor(colonyname))) + geom_jitter() +ylim(0,0.05) +ylab('Weight loss (gm)')+xlab('')# 5 spider colonies
p1<-ggplot(wts1, aes(x=as.factor(colonyname),y=wtlss,color=as.factor(colonyname))) +geom_jitter()+ylim(0,0.05) +ylab('Weight loss (gm)') + xlab('')# 5 spider colonies


multiplot(p1,p5,p10,p25,cols=2)

ps<-ps+1

```

###*Plot `r ps`:* Does average spiders size predict per-capita silk investment?

####A plot of cephalothorax widths of each colony and the length of silk invested.

```{r,echo=FALSE,warning=FALSE}
G1<-ggplot(wtlscol,aes(x=mncephwidth,y=Length/pixpm/groupsize,colour=as.factor(groupsize)))+geom_point(size=5);G1+xlab(' Mean cephalothorax width (mm)')+ ylab('Per capita silk invested on day 7 (metres)')+ geom_errorbarh(aes(xmax = mncephwidth + sdceph, xmin = mncephwidth - sdceph, height = .5))


ps<-ps+1
```

####Spider size doesn't seem to affect length of silk invested. 

###*Plot `r ps`:* Does spider size predict weight loss? 

####If spider size somehow predicts weight loss , this would be indicative of inter-individual diff in web construction !! 

```{r,echo=FALSE,warning=FALSE}
gp<-ggplot(wts,aes(x=wtlss,y=cephwid,colour=as.factor(groupsize) ))
gp+geom_point(size=3.2)+xlab('Weight loss (gm)')+ylab('Cephalothorax width (mm)')
ps<-ps+1

```




------------------

#_Spatiotemporal analyses_:


###Do all the grids grow in the same way?
#### A plot of the amount of silk in each grid through time. This will tell if there is some kind of common 'threshold' at which all girds stop growing, or if the growth of grids shows similarity.


```{r,echo=FALSE}
# plot to create lines for each grid's silk density:
grdplt<-function(gs,colname,d,YMAX)
  {
w<-subset(d,d$GridSize==gs & d$colonyname==colname)
mxdays<-max(w$day)
A<-array(data=unlist(w$Length),c(gs,gs,mxdays))

# normalise the amount of silk by the area of the grid:
imsize=1536; # length/breadth of the image in pixels
gdim=1536/gs; # length of side of a grid 
gdarea= gdim^2 # area of one grid

for (i in 1:gs)
  {
  for(j in 1:gs)
{
    nrmsilk<-A[i,j,1:mxdays]/gdarea
    t<-1:mxdays
    
 if (i==1 & j==1)
  {
   plot(t,nrmsilk,xlim=c(1,10),ylim=c(0,YMAX),main=sprintf('%s',colname),ylab='Silk Density (Length of silk/Area)',xlab='Days',pch=NA,lty=1)
  
   }
 
 lines(t,nrmsilk,lty=1,col=i*j)
  
  }
}

}

```

```{r,echo=FALSE}
### the GRID SIZE TO BE USED:
gs=16; # grid size that will be plotted:

```

####The webs were broken into `r gs^2` grids, and the length of silk was divided by the area of the grid. Each line in the plot is the trajectory of one grid. I chose the 8x8 layout as it was not too fine, nor too large, and intend to repeat all these plots + analyses with another spatial resolution.

####Single spider webs:
```{r,echo=FALSE}

par(mfrow=c(2,3))

c1name=c('1A','1B','1C','1D','1F','1G');
for (cn in c1name)
{
grdplt(gs,cn,d,0.25)
}

####5 spider webs :
par(mfrow=c(2,2))
c5name<-c('5A','5E','5F','5H')
for (cn5 in c5name)
{
grdplt(gs,cn5,d,0.25)
}

####10 spider webs

par(mfrow=c(2,4))
c10name<-c('10A','10B','10C','10D','10E','10F','10G')

for (cn10 in c10name)
{
grdplt(gs,cn10,d,0.25)
}

####25 spider webs
par(mfrow=c(2,3))
c25name<-c('25A','25D','25E','25F','25G','25H')

for (cn25 in c25name)
{
grdplt(gs,cn25,d,0.25)
}
```

####And, just in case, a super-messy plot to check for overall trends 
```{r,echo=FALSE,warning=FALSE,fig.width=10,fig.height=13}
# code to create one MASSIVE block of plots : (not active)
par(mfrow=c(6,4),mar=c(1,1,2,1))
for (cnall in c(c1name,c5name,c10name,c25name) )
  {
 grdplt(gs,cnall,d,0.25)
  }

```

####The plots show that with an 8^2^ grid the 5,10 and 25 group webs tend to reach a maximal value of about 0.15-0.175 - which hints at a common threshold in larger group sizes (5,10,25). This kind of common pattern is seen even at other spatial resolutions too (16^2^, 32^2^, 64^2^ grids)

### Rate of change of grid silk  densities:
####Make a plot of rate of change of thhe variable by value of the variable
####Eg. dY vs Y . If there is a common threshold, the rate of change should be the lowest there. Also, this will also reveal if there are any peaks in the $\Delta$Silk density vs Silk density function. 

```{r,echo=FALSE}
# function to make line plots of al the grids at any grid size : a dY / Y plot

# gs<-group size
# colname: colony name
# d is the LARGE dataset with multiple colony and grid size information
# YMAX is the plotting parameter for the y axis limit

dgrdplt<-function(gs,colname,d,YMAX)
  {
w<-subset(d,d$GridSize==gs & d$colonyname==colname)
mxdays<-max(w$day)
A<-array(data=unlist(w$Length),c(gs,gs,mxdays))

# normalise the amount of silk by the area of the grid:
imsize=1536; # length/breadth of the image in pixels
gdim=1536/gs; # length of side of a grid 
gdarea= gdim^2 # area of one grid

for (i in 1:gs)
  {
  for(j in 1:gs)
{
    nrmsilk<-A[i,j,1:mxdays]/gdarea
    cutnrmsilk<-head(nrmsilk,-1) # nrmsilk without the last element
    dnrmsilk<-nrmsilk[-1]-cutnrmsilk#change in silk density
    
    
 if (i==1 & j==1) # to initialise the plot window
  {
   ylb<-expression(paste(Delta,'Silk density'))
   plot(cutnrmsilk,dnrmsilk,main=sprintf('%s',colname),ylab=ylb,pch=NA,lty=2,ylim=c(-0.05,YMAX),xlim=c(0,0.2),xlab='Silk density')
  
   }
 
 lines(cutnrmsilk,dnrmsilk,type='o',pch=20,col=i*j) # overlaying all trajectories
  
  }
}

}

```

####Single spider webs:
```{r,echo=FALSE}
par(mfrow=c(2,3))

c1name=c('1A','1B','1C','1D','1F','1G');
for (cn in c1name)
{
dgrdplt(gs,cn,d,0.25)
}
```

####5 spider webs :
```{r,echo=FALSE}
par(mfrow=c(2,2))
c5name<-c('5A','5E','5F','5H')

for (cn5 in c5name)
{
dgrdplt(gs,cn5,d,0.25)
}
```

####10 spider webs
```{r,echo=FALSE}
par(mfrow=c(2,4))
c10name<-c('10A','10B','10C','10D','10E','10F','10G')

for (cn10 in c10name)
{
dgrdplt(gs,cn10,d,0.25)
}
```

####25 spider webs
```{r,echo=FALSE}
par(mfrow=c(2,3))
c25name<-c('25A','25D','25E','25F','25G','25H')

for (cn25 in c25name)
{
dgrdplt(gs,cn25,d,0.25)
}
```
```{r,echo=FALSE,eval=FALSE}
# code to create one MASSIVE block of plots : (not active)
par(mfrow=c(6,4),mar=c(1,1,2,1))
for (cnall in c(c1name,c5name,c10name,c25name) )
  {
 dgrdplt(gs,cnall,d,0.25)
  }

```

####We can see that the $\Delta$Silk density vs Silk density function is  kind of triangular, with a peak at various densities (possibly depending on the location of the grid)  and then actually seems to drop linearly to zero! The fact that it appears linear is pretty cool I think. 

####The negative values are there only because of the measurement error, and will be removed in due course. 

####As revealed from the previous set of plots, the maximal threshold of 0.15-0.175 is still seen here, with most grid trajectories dropping to zero at these values. 

####And, just in case, a super-messy plot to check for overall trends 
```{r,echo=FALSE,warning=FALSE,fig.width=10,fig.height=13}
# code to create one MASSIVE block of plots : (not active)
par(mfrow=c(6,4),mar=c(1,1,2,1))
for (cnall in c(c1name,c5name,c10name,c25name) )
  {
 dgrdplt(gs,cnall,d,0.25)
  }

ps<-ps+1
```




```{r,aligner chunk,echo=FALSE,warning=FALSE,results='hide',message=FALSE}

# function to align a bunch of vectors aligned as rows :
# M is a matrix/dataframe with each row having the values for a colony and each column values on tha day. (wide format data)


#function to 'push a vector t by the given index. Input:vector, output:vector
pusher<-function(v,i)
    {
   L<-length(unlist(v))
    vec<-matrix(data=NA,nrow=1,ncol=L)
    
  if (is.na(i)==FALSE)
    
    {
  
    lfrag<-length(i:L)
    vec[1:lfrag]<-unlist(v)[i:L]
    return(vec)
    } 
  else if (is.na(i)==TRUE)
    {return(vec)}
  
    }

# function to find the start index of entry >0. Input:vector, output: number
minind<-function(v){
  if (sum(v==0,na.rm=T)!=sum(is.na(v)==FALSE))
    { min(which(v>0))}
  else 
    if (sum(v==0,na.rm=T)==sum(is.na(v)==FALSE))
      {return(NA)}


    } 
  
# M is a compilation of vectors :
#INput: Matrix with each cell as one row 
# Output: Matrix with aligned rows
aliner<-function(M)
  {
 
  strtInds<-apply(M,1,minind) # starting indices ..the indices which are greater than 0
  # now 'push' each row to start from the strtInds
  ml<-apply(M,1,function(obj){list(as.vector(unname(obj)))})
alYned<-mapply(pusher,i=strtInds,v=ml);alYned<-t(alYned) # performs the pushing over all the vectors and aligns them :
return(alYned) 

}


 # converting a whole vector of numbers into an array, and then into a wide format ALIGNED data ! 
formtr<-function(Length,gs,mxdays)
{
  A<-array(data=unlist(Length),c(gs,gs,mxdays))
  amlt<-melt(A);

clwise<-acast(amlt,amlt[,1]*amlt[,2]~amlt[,3]) # cell wise data set w each row for one cell! 

Alind<-aliner(clwise);

return(Alind)
}


# the frmtr function w/o alignment 
  formtr2<-function(Length,gs,mxdays)
{
  A<-array(data=unlist(Length),c(gs,gs,mxdays))
  amlt<-melt(A);

clwise<-acast(amlt,amlt[,1]*amlt[,2]~amlt[,3]) # cell wise data set w each row for one cell! 


return(clwise)
}

  

```


### Plot `r ps`: Is grid architecture dependent on group size ?
####I plotted all aligned grid trajectories from webs built by all group-sizes (all colonies together) across time:

```{r,mapplyzefmtr,echo=FALSE,warning=FALSE,message=FALSE,results='hide'}
source(paste(comad,'ggrpsizefmtr scripts.R',sep=''))
# making the transition from raw dataframe -->ggplot2 suitable dataset:
# ggrpsizfmtr removes the 0 value grids . 
# ggrpsizfmtr2 keeps the 0 value grids  - bad scripting I know, but I got lazy.
# Make an UNALIGNED dataset across all colonies and grousizes:
# Make an UNALIGNED dataset across all colonies and grousizes:
Grpsz<-rep(unique(d$groupsize),3) # list of the groupsizes ...repeated so that all combinations of groupsizexgridsize will be achieved
gdsz<-rep(tail(unique(d$GridSize),3),4)
FOP<-rep(1,12)
zeropts1<-list(rep(1,12)) # if zeropts ==1 , then remove the grids with zero values, if ==1 , then keep grids with 0 values.
source(paste(comad,'bidatmaker.R',sep='')); 
bigDat01<-bigdatmaker(Grpsz,gdsz,FOP,zeropts1)# Making ALIGNED dataset for all grid sizes 
bigDat01$groupsize<-as.factor(bigDat01$groupsize);
bigDat01$groupsize<-factor(bigDat01$groupsize,levels=c('1','5','10','25'));

```

```{r,overlappinggridtrajectorieslooping,echo=FALSE,warning=FALSE,message=FALSE,results='hide'}

m32<-subset(bigDat01,GridSize==32)
m16<-subset(bigDat01,GridSize==16)
m64<-subset(bigDat01,GridSize==64)



bigDat01$groupsize<-as.factor(bigDat01$groupsize);
ordered(bigDat01$groupsize,levels=c('1','5','10','25'));
       
m32<-subset(bigDat01,GridSize==32)


```

```{r,are grids similar across group sizes,echo=FALSE,warning=FALSE,message=FALSE,fig.show = 'hold',fig.height=8,out.width = '49%'}
acalc<-function(grids){(1536/grids)^2}

M16<-ggplot(m16,aes(x=day,y=Length/acalc(16),group=groupsize,color=as.factor(groupsize)))+stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5,position=position_dodge(width=0.65))

M32<-ggplot(m32,aes(x=day,y=Length/acalc(32),group=groupsize,color=as.factor(groupsize)))+stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5,position=position_dodge(width=0.65))

  M64<-ggplot(m64,aes(x=day,y=Length/acalc(64),group=groupsize,color=as.factor(groupsize)))+stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5,position=position_dodge(width=0.65))

M16+xlab(sprintf('%s %d grids','Days',16))+ylab('Silk density')+scale_x_discrete(breaks=c(1:10),labels=c(1:10))+ylim(0,0.3)

M32+xlab(sprintf('%s %d grids','Days',32))+ylab('Silk density')+scale_x_discrete(breaks=c(1:10),labels=c(1:10))+ylim(0,0.3)

M64+xlab(sprintf('%s %d grids','Days',64))+ylab('Silk density')+scale_x_discrete(breaks=c(1:10),labels=c(1:10))+ylim(0,0.3)

ps<-ps+1
```

####These plots show that when you compensate for the *rate* of web growth by aligning the grid trajectories, the architecture of the grids resemble each other. However, at all spatial resolutions considered, there is still some effect of group size on the silk density of a grid. 

###Plot `r ps`: A plot of __*unaligned*__ grid trajectories:

```{r,NONALIGNEDgridplots,echo=FALSE,warning=FALSE,message=FALSE,fig.show='hold',fig.height=8,out.width='49%'}

grd162lts<-list()
grd322lts<-list()
grd642lts<-list()
for (i in 1:4)
  {
gszs<-list(unique(d$groupsize)[i])
untimes<-length(unlist(gszs)) # number of groupsizes in expt
gs16=list(rep(16,untimes))
gs32=list(rep(32,untimes))
gs64=list(rep(64,untimes))
z1<-list(rep(1,untimes))
fop1<-list(rep(1,untimes))
fop2<-list(rep(2,untimes))

grd162lts[[i]]<-mapply(ggrpsizfmtr,gs=gs16,Grpsize=gszs,foption=fop2,zeropts=z1) #grid lengths by spider groupsize
grd322lts[[i]]<-mapply(ggrpsizfmtr,gs=gs32,Grpsize=gszs,foption=fop2,zeropts=z1) #grid lengths by spider groupsize
grd642lts[[i]]<-mapply(ggrpsizfmtr,gs=gs64,Grpsize=gszs,foption=fop2,zeropts=z1) #grid lengths by spider groupsize
  }

datfrmkr<-function(LST){data.frame(lapply(data.frame(t(sapply(LST, `[`))), unlist))}
# now to make the giant dataframe:
DF162<-list()
DF322<-list()
DF642<-list()
for (i in 1:4)
  {
    df162<-datfrmkr(grd162lts[i])
    df162$groupsize<-unique(d$groupsize)[i]
      DF162[[i]]<-df162
  df322<-datfrmkr(grd322lts[i])
  df322$groupsize<-unique(d$groupsize)[i]
      DF322[[i]]<-df322
  df642<-datfrmkr(grd642lts[i])
  df642$groupsize<-unique(d$groupsize)[i]
      DF642[[i]]<-df642
  }
massv162<-do.call(rbind,DF162) # massive dataset w 16 grids:
massv322<-do.call(rbind,DF322) # massive dataset w 32 grids:
massv642<-do.call(rbind,DF642) # massive dataset w 64 grids:

nms<-c('colonyname','GridSNo','GridSize','day','Length','groupsize')
m322<-massv322;names(m322)<-nms
m162<-massv162;names(m162)<-nms
m642<-massv642;names(m642)<-nms

acalc<-function(gds){return((1536/gds)^2)}

M162<-ggplot(m162,aes(x=day,y=Length/acalc(16),group=groupsize,color=as.factor(groupsize)))+stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5,position=position_dodge(width=0.65))
M322<-ggplot(m322,aes(x=day,y=Length/acalc(32),group=groupsize,color=as.factor(groupsize)))+stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5,position=position_dodge(width=0.65))
M642<-ggplot(m642,aes(x=day,y=Length/acalc(64),group=groupsize,color=as.factor(groupsize)))+stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5,position=position_dodge(width=0.65))

M162+xlab(sprintf('%s %d grids','Days',16))+ylab('Silk density')+scale_x_discrete(breaks=c(1:10),labels=c(1:10))

M322+xlab(sprintf('%s %d grids','Days',32))+ylab('Silk density')+scale_x_discrete(breaks=c(1:10),labels=c(1:10))

M642+xlab(sprintf('%s %d grids','Days',64))+ylab('Silk density')+scale_x_discrete(breaks=c(1:10),labels=c(1:10))

ps<-ps+1
```

####This will obviously show drastic differences with time, because the rate of development in the webs is dependent on grid size. And so larger groups of spiders will develop webs/grids with higher silk density quicker than smaller groups.


###Plot `r ps`:Colony-level variation in web architecture:
####How much variation is there at the grid level across colonies of the same group size ? : A look at the aligned grid trajectories at multiple spatial resolutions

```{r, colonylevelgrids,echo=FALSE,warning=FALSE,message=FALSE,fig.width=8,fig.height=6,fig.align='left'}

#### 1 spiders

M16col1<-ggplot(subset(m16,m16$groupsize==1),aes(x=day,y=Length/acalc(16),group=colonyname,color=as.factor(colonyname)))+stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5,position=position_dodge(width=0.65))+ylim(0,0.25)
M32col1<-ggplot(subset(m32,m32$groupsize==1),aes(x=day,y=Length/acalc(32),group=colonyname,color=as.factor(colonyname)))+stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5,position=position_dodge(width=0.65))+ylim(0,0.25)
M64col1<-ggplot(subset(m64,m64$groupsize==1),aes(x=day,y=Length/acalc(64),group=colonyname,color=as.factor(colonyname)))+stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5,position=position_dodge(width=0.65))+ylim(0,0.25)

#### 5 spider
M16col5<-ggplot(subset(m16,m16$groupsize==5),aes(x=day,y=Length/acalc(16),group=colonyname,color=as.factor(colonyname)))+stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5,position=position_dodge(width=0.65))+ylim(0,0.25)
M32col5<-ggplot(subset(m32,m32$groupsize==5),aes(x=day,y=Length/acalc(32),group=colonyname,color=as.factor(colonyname)))+stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5,position=position_dodge(width=0.65))+ylim(0,0.25)
M64col5<-ggplot(subset(m64,m64$groupsize==5),aes(x=day,y=Length/acalc(64),group=colonyname,color=as.factor(colonyname)))+stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5,position=position_dodge(width=0.65))+ylim(0,0.25)

####10 spider

M16col10<-ggplot(subset(m16,m16$groupsize==10),aes(x=day,y=Length/acalc(16),group=colonyname,color=as.factor(colonyname)))+stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5,position=position_dodge(width=0.65))+ylim(0,0.25)
M32col10<-ggplot(subset(m32,m32$groupsize==10),aes(x=day,y=Length/acalc(32),group=colonyname,color=as.factor(colonyname)))+stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5,position=position_dodge(width=0.65))+ylim(0,0.25)
M64col10<-ggplot(subset(m64,m64$groupsize==10),aes(x=day,y=Length/acalc(64),group=colonyname,color=as.factor(colonyname)))+stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5,position=position_dodge(width=0.65))+ylim(0,0.25)

### 25 spider 
M16col25<-ggplot(subset(m16,m16$groupsize==25),aes(x=day,y=Length/acalc(16),group=colonyname,color=as.factor(colonyname)))+stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5,position=position_dodge(width=0.65))+ylim(0,0.25)

M32col25<-ggplot(subset(m32,m32$groupsize==25),aes(x=day,y=Length/acalc(32),group=colonyname,color=as.factor(colonyname)))+stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5,position=position_dodge(width=0.65))+ylim(0,0.25)

M64col25<-ggplot(subset(m64,m64$groupsize==25),aes(x=day,y=Length/acalc(64),group=colonyname,color=as.factor(colonyname)))+stat_summary(fun.y = median, fun.ymin = q025,fun.ymax =q975 ,size=1.5,position=position_dodge(width=0.65))+ylim(0,0.25)
```


```{r,echo=FALSE,warning=FALSE,out.width='32%',fig.height=8,fig.show='hold'}
M16col1+ggtitle('16 grids')+ylab('Silk density (Length/Area)') + theme(legend.position="none")+xlab('')
M32col1+ggtitle('1 spider groups 32 grids')+ theme(legend.position="none")+ylab('')
M64col1+ggtitle('64 grids') + theme(legend.position=c(0.65,0.05), legend.direction="horizontal")+ylab('')+xlab('')
```

#### '1A'  seems to have a rather high density of web from the others.
```{r,echo=FALSE,warning=FALSE,out.width='32%',fig.height=8,fig.show='hold'}
M16col5+ggtitle('16 grids')+ylab('Silk density (Length/Area)') + theme(legend.position="none")+xlab('')
M32col5+ggtitle('5 spider groups 32 grids') + theme(legend.position="none")+ylab('')
M64col5+ggtitle('64 grids')+ylab('')+ theme(legend.position=c(0.65,0.05), legend.direction="horizontal")+xlab('')
```

####The 5 spider groups seem to show a little more variation in web architecture than the others, but this could also be because of the lower sample size (N=4), in comparison to N=6/7 of the other group sizes.
```{r,echo=FALSE,warning=FALSE,out.width='32%',fig.height=8,fig.show='hold'}
M16col10+ggtitle('16 grids')+ theme(legend.position="none")+ylab('Silk density (Length/Area)')+xlab('')
M32col10+ggtitle('10 spider groups 32 grids')+ylab('') +theme(legend.position="none")
M64col10+ggtitle('64 grids')+ylab('')+ theme(legend.position=c(0.65,0.05), legend.direction="horizontal")+xlab('')

```

```{r,echo=FALSE,warning=FALSE,out.width='32%',fig.height=8,fig.show='hold'}
M16col25+ggtitle('16 grids')+theme(legend.position="none")+ylab('Silk density (Length/Area)')+xlab('')
M32col25+ggtitle('25 spider groups 32 grids')+ylab('')+theme(legend.position="none")
M64col25+ggtitle('64 grids')+ylab('')+ theme(legend.position=c(0.65,0.05), legend.direction="horizontal")+xlab('')
```

####10 and 25 spider groups seem to have pretty good clustering in architecture. 






###Plot `r ps`: Does spider size predict silk density?
#### We expect a general linear trend (including 2d errorbars) between spider size and silk density

####And,this is the real data: I've made plots of two time points to understand if a trend that's not very apparent in the first day appears at a later time-point. 

```{r,silkden depend on spider size,echo=FALSE,message=FALSE,warning=FALSE}
#function which calculates q0.025 and q975 for a given vector:
q95ile<-function(V)
  {
  D<-c( quantile(V,0.025,na.rm=T) ,quantile(V,0.5,na.rm=T) ,quantile(V,0.975,na.rm=T))
  return(D)
  }

# ceph size Vs Grid Density maker : "siz-dens-mkr"
#Input: dataframe with grid-level data of Lengths+day+colonyname
# Output: ggplot of silk density vs ceph width w the horizontal and vertical errobars
sbst<-function(V){substr(V,1,nchar(V)-1)}
sizdensmkr<-function(M,grids){
Colceph<-by(wts$cephwid,wts$colonyname,q95ile) # colonywise cephalothorax limits:
colceph<-do.call(rbind,Colceph) # compiling it all.
colgrids<-do.call(rbind,by(M$Length,M$colonyname,q95ile))/acalc(grids)

cephngrid<-cbind(colceph,colgrids);colnames(cephngrid)<-c('ceph0.025','cephmed','ceph0.975','gd0.025','gdmed','gd0.975')

grps<-as.numeric(sbst(rownames(cephngrid)))


cgd<-data.frame(cephngrid)
cgd$groupsize<-grps
cgd$colonyname<-rownames(cephngrid)

Sizenden<-ggplot(data=cgd,aes(x=cephmed,y=gdmed,color=as.factor(groupsize)))+ geom_errorbarh(aes(xmax = ceph0.975, xmin = ceph0.025))+geom_point(size=3) + geom_errorbar(aes(ymax=gd0.975,ymin=gd0.025))+ylim(0,0.25)
return(Sizenden)
}

```

```{r,sizdensplotting,echo=FALSE,message=FALSE,warning=FALSE,fig.height=6,fig.align='center',fig.width=10}

one16<-sizdensmkr(subset(m16,m16$Length>0 & m16$day==1),16)+xlab('Cephalothorax width (mm)')+ylab('Silk density of grids (Length of silk/area)')+ggtitle('16 grids day 1')+ theme(legend.position="top")
fiv16<-sizdensmkr(subset(m16,m16$Length>0 & m16$day==5),16)+xlab('Cephalothorax width (mm)')+ylab('')+ggtitle('16 grids day 5')+ theme(legend.position="top")

multiplot(one16,fiv16,cols=2)


one32<-sizdensmkr(subset(m32,m32$Length>0 & m32$day==1),32)+xlab('Cephalothorax width (mm)')+ylab('Silk density of grids (Length of silk/area)')+ggtitle('32 grids day 1')+ theme(legend.position="top")
fiv32<-sizdensmkr(subset(m32,m32$Length>0 & m32$day==5),32)+xlab('Cephalothorax width (mm)')+ylab('')+ggtitle('32 grids day 5(aligned)')+ theme(legend.position="top")
multiplot(one32,fiv32,cols=2)


one64<-sizdensmkr(subset(m64,m64$Length>0 & m64$day==1),64)+xlab('Cephalothorax width (mm)')+ylab('Silk density of grids (Length of silk/area)')+ggtitle('64 grids day 1')+ theme(legend.position="top")
fiv64<-sizdensmkr(subset(m64,m64$Length>0 & m64$day==5),64)+xlab('Cephalothorax width (mm)')+ylab('')+ggtitle('64 grids day 5(aligned)')+ theme(legend.position="top")
multiplot(one64,fiv64,cols=2)

ps<-ps+1

```



####Plot `r ps`: Spatial growth over time:
####We look at how the total %age of boxes occupied vary with time. This is a binary calculation of the %age of boxes with or without silk.

```{r,areabyttime,echo=F,message=FALSE,warning=FALSE}

comad2<-'C:/Users/Thejasvi/Google Drive/stego web/web-construction FINAL round - raw data/analysis-FINALround/analysis-results/feb_2016_Rmdfiles'

source(paste(comad2,'/occupancy_analysis.R',sep=''))
occupplot<-ggplot(ocpdtst,aes(x=as.factor(day),y=pctgarea,group=colonyname,color=as.factor(groupsize)))+geom_line(lwd=2)+ylab('Percentage area covered')+xlab('Day')+theme(legend.title=element_blank());occupplot
names(ocpdtst)[5]<-'pctgarea'


# and now for the same occupancy staggered plot :

mgocpplt





```


# 



#### Moreover, we can compare the 'overall silk density' across groupsizes here. By dividing the total length of silk by the total available area we can come up with an estimate of filled up the webs are:

```{r, overal silk density,echo=F,warning=FALSE,message=F}
source(paste(comad2,'/overall_silk_density.R',sep=''))

ovrldensplot<-ggplot(subset(wd,day<10),aes(x=as.factor(day),y=ovrldens,group=colonyname,color=as.factor(groupsize)))+geom_line(lwd=2)+ylab('Overall density (1/m)')+xlab('Day')+theme(legend.title=element_blank());ovrldensplot


# or for the same kind of fancy staggered plot 
mgovrlplt








```




####And now we can take a look at how the expansion of new web areas (Delta area) looks along with the silk investment over t:i

```{r,del area ,echo=F,warning=FALSE,message=F}
# and now let's take a look at how the delta area and the delta silk proceed side-by-side:

pcp2_2<-ggplot(dlenth,aes(x=as.factor(day),y=percap/pixpm,group=groupsize,colour=as.factor(groupsize)))+geom_point(size=4)+geom_smooth(linetype='solid',lwd=2,level=0.9)+ylab('Per-capita silk investment (m)') + xlab('Days')+theme(legend.title=element_blank());


pcp2_a<-ggplot(dlenth,aes(x=as.factor(day),y=percap/pixpm,group=colonyname,colour=as.factor(groupsize)))+geom_point(size=4)+ylab('Per-capita silk investment (m)') + xlab('Days')+theme(legend.title=element_blank())+geom_line(lwd=0.75);pcp2_a

# Delta area plot:


deltareanonsmooth<-ggplot(daread,aes(x=as.factor(day),y=daread$dpctage*100,group=colonyname,colour=as.factor(groupsize)))+geom_point(size=4)+ylab('Delta area percentage') +geom_line(lwd=1.5) +xlab('Days') +theme(legend.title=element_blank()) ; deltareanonsmooth

deltarea<-ggplot(daread,aes(x=as.factor(day),y=daread$dpctage*100,group=groupsize,colour=as.factor(groupsize)))+geom_point(size=4)+geom_smooth(linetype='solid',lwd=2,level=0.9)+ylab('Delta area percentage') + xlab('Days') +theme(legend.title=element_blank()) ; deltarea


# a delta


# a normalised 'percapita' plot..which doesn't make sense right now..
pcdeltarea<-ggplot(daread,aes(x=as.factor(day),y=(daread$dpctage*100)/as.numeric(daread$groupsize),group=groupsize,colour=as.factor(groupsize)))+geom_point(size=4)+geom_smooth(linetype='solid',lwd=2,level=0.9)+ylab('Per capita area contribution - %age') + xlab('Days') +theme(legend.title=element_blank())

multiplot(pcdeltarea,pcp2_2)


```

```{r, delarea AND del silk,echo=FALSE,message=F,warning=F}
# need to have a delarea - area plot here :


# and now looking at how delarea and delsilk are related :

# if silk investment is ALWAYS linked to area growth, then it'll be a straight line relationship between them - if there are kinks in this line - it says other things :) 
delar_sil<-merge(daread,dlenth,by=c('day','colonyname','groupsize'))

pdsilkar<-ggplot(delar_sil,aes(x=dpctage*100,y=dLength/pixpm,group=colonyname,colour=as.factor(groupsize)))+geom_line(lwd=1.5)+scale_x_reverse( lim=c(35,0))+scale_y_reverse( lim=c(40,0)) + ylab('Delta Length') + xlab('Delta area %age');

pcapsilkar<-ggplot(delar_sil,aes(x=dpctage*100,y=(percap/pixpm),group=colonyname,colour=as.factor(groupsize)))+geom_line(lwd=1.5)+scale_x_reverse( lim=c(35,0))+scale_y_reverse( lim=c(5,0)) + ylab('percapita per day') + xlab('Delta area %age');


# I think this zig-zag pattern is showing what I was thinking. 
# the up-inclined segments show regions where high silk investment w/o area growth happened, and the down-clined slopes -: where both silk invstmt and area growth happened
 
# as we can see here - there's always parts of the trajectories where there are gaps between 

# -- is it just me - or do ALL of  the colonies show this zig-zag pattern - between expansion and filling up ?? ....check this  out properly !! 

ggplot(subset(delar_sil,groupsize==1),aes(x=dpctage*100,y=dLength/pixpm,group=colonyname,colour=as.factor(colonyname)))+geom_line(lwd=1.5)+scale_x_reverse( lim=c(6,0))+scale_y_reverse( lim=c(6,0)) + ylab('Delta Length') + xlab('Delta area %age')


ggplot(subset(delar_sil,groupsize==5),aes(x=dpctage*100,y=dLength/pixpm,group=colonyname,colour=as.factor(colonyname)))+geom_line(lwd=1.5)+scale_x_reverse( lim=c(20,0))+scale_y_reverse( lim=c(15,0)) + ylab('Delta Length') + xlab('Delta area %age')

ggplot(subset(delar_sil,groupsize==10),aes(x=dpctage*100,y=dLength/pixpm,group=colonyname,colour=as.factor(colonyname)))+geom_line(lwd=1.5)+scale_x_reverse( lim=c(27,0))+scale_y_reverse( lim=c(25,0)) + ylab('Delta Length') + xlab('Delta area %age')

ggplot(subset(delar_sil,groupsize==25),aes(x=dpctage*100,y=dLength/pixpm,group=colonyname,colour=as.factor(colonyname)))+geom_line(lwd=1.5)+scale_x_reverse( lim=c(35,0))+scale_y_reverse( lim=c(40,0)) + ylab('Delta Length') + xlab('Delta area %age')

# now...I wanna normalise the delLength with percapita , and see if it kind of merges in :P 




```



-----------------------------------------------------------------
```{r,centredregression, echo=TRUE,message=FALSE,warning=FALSE}
# decided to do a centred regression 

source(paste(comad2,'/centred_regression.R',sep=''))

print(summary(centreg(4)))

```


#### However, as we can see, our centred regression are failing to give a significant estimate of the intercept - and this doesn't help us with our aims to test if silk investment is affected by groupsize

####The next step is to then use some kind of a proportion test. I placed together the same data and divided the each Lengthvalue by its groupsize. This gives the expected value if it was a single spider acting independent of all others. Then I ran a Friedman's test onto this dataframe. 

```{r,centered regression,echo=FALSE}

#
source(paste(comad2,'/proportion_comparison.R',sep=''))

rslts<-proptester(4) # do the test for data from day 4

print(rslts [[5]])

```


#### Is the per-capita silk investment uniform across time and groupsize ? 
#### the results suggests not - which means that the spiders are adding the same amount of silk across time and groupsize. P.S. The 'warning' that appears does not affect the reliability of the test results - pers comm with package author)

```{r,nparLD,echo=FALSE,message=F,warning=F}

source(paste(comad2,'/nparLD_analysis.R',sep=''))

# also - don't worry about the 'warning :covariance matrix is singular' - 
# pers comm from 1st author off the package that it doesn't affect the results of the test

plot(res)
print(res$ANOVA.test)


```

